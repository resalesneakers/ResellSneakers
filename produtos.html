<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResellSneakers - Encontra o Teu Par Perfeito</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
    :root {
        --primary-color: #ff4b36;
        --secondary-color: #212121;
        --accent-color: #4a90e2;
        --light-gray: #f5f5f5;
        --medium-gray: #e0e0e0;
        --dark-gray: #757575;
        --white: #ffffff;
        --border-radius: 8px;
        --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s ease;
    }
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: 'Poppins', sans-serif;
        line-height: 1.6;
        color: var(--secondary-color);
        background-color: var(--light-gray);
    }
    
    a {
        text-decoration: none;
        color: inherit;
    }
    
    button {
        cursor: pointer;
        border: none;
        background: none;
        font-family: inherit;
    }
    
    ul {
        list-style: none;
    }
    
    .container {
        max-width: 1280px;
        margin: 0 auto;
        padding: 20px;
        display: flex;
        gap: 30px;
    }
    
    /* Barra de Navegação */
    .navbar {
        background-color: var(--white);
        padding: 15px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: var(--shadow);
    }
    
    .logo a {
        font-size: 24px;
        font-weight: 700;
        color: var(--primary-color);
    }
    
    .search-bar {
        display: flex;
        align-items: center;
        flex: 1;
        max-width: 500px;
        margin: 0 20px;
    }
    
    .search-bar input {
        flex: 1;
        padding: 10px 15px;
        border: 1px solid var(--medium-gray);
        border-radius: var(--border-radius) 0 0 var(--border-radius);
        font-family: inherit;
        font-size: 14px;
    }
    
    .search-bar button {
        background-color: var(--primary-color);
        color: var(--white);
        padding: 10px 15px;
        border-radius: 0 var(--border-radius) var(--border-radius) 0;
        transition: var(--transition);
    }
    
    .search-bar button:hover {
        background-color: #e53935;
    }
    
    .nav-links {
        display: flex;
        align-items: center;
        gap: 20px;
    }
    
    .nav-links a {
        color: var(--secondary-color);
        font-weight: 500;
        transition: var(--transition);
    }
    
    .nav-links a:hover {
        color: var(--primary-color);
    }
    
    .nav-links a.active {
        color: var(--primary-color);
    }
    
    .login-btn {
        background-color: var(--primary-color);
        color: var(--white) !important;
        padding: 8px 16px;
        border-radius: var(--border-radius);
        transition: var(--transition);
    }
    
    .login-btn:hover {
        background-color: #e53935;
    }
    
    .menu-toggle {
        display: none;
        font-size: 24px;
        cursor: pointer;
    }
    
    /* Estilos do Conteúdo Principal */
    main {
        padding: 20px 0;
        min-height: calc(100vh - 70px - 200px); /* Ajustar consoante a altura da navbar e footer */
    }
    
    /* Secção de Filtros */
    .filters {
        width: 250px;
        background-color: var(--white);
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        position: sticky;
        top: 90px;
        height: fit-content;
    }
    
    .filters h2 {
        margin-bottom: 20px;
        font-size: 20px;
        border-bottom: 1px solid var(--medium-gray);
        padding-bottom: 10px;
    }
    
    .filter-group {
        margin-bottom: 20px;
    }
    
    .filter-group h3 {
        font-size: 16px;
        margin-bottom: 10px;
        font-weight: 500;
    }
    
    .filter-options {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .filter-options label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        cursor: pointer;
    }
    
    .filter-options input[type="checkbox"] {
        cursor: pointer;
    }
    
    .size-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
    }
    
    .price-range {
        margin-top: 10px;
    }
    
    .price-range input[type="range"] {
        width: 100%;
        margin-bottom: 10px;
    }
    
    .price-inputs {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .price-inputs input {
        flex: 1;
        padding: 6px;
        border: 1px solid var(--medium-gray);
        border-radius: 4px;
        font-size: 14px;
        width: 70px;
    }
    
    .apply-filters, .reset-filters {
        width: 100%;
        padding: 10px;
        border-radius: var(--border-radius);
        font-weight: 500;
        transition: var(--transition);
        margin-bottom: 10px;
    }
    
    .apply-filters {
        background-color: var(--primary-color);
        color: var(--white);
    }
    
    .apply-filters:hover {
        background-color: #e53935;
    }
    
    .reset-filters {
        background-color: var(--light-gray);
        border: 1px solid var(--medium-gray);
    }
    
    .reset-filters:hover {
        background-color: var(--medium-gray);
    }
    
    /* Secção de Produtos */
    .products {
        flex: 1;
    }
    
    .products-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .products-header h2 {
        font-size: 24px;
    }
    
    .sort-options {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .sort-options select {
        padding: 8px 12px;
        border: 1px solid var(--medium-gray);
        border-radius: var(--border-radius);
        font-family: inherit;
        font-size: 14px;
        background-color: var(--white);
    }
    
    .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .product-card {
        background-color: var(--white);
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--shadow);
        transition: var(--transition);
    }
    
    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .product-image {
        position: relative;
        height: 180px;
        overflow: hidden;
    }
    
    .product-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: var(--transition);
    }
    
    .product-card:hover .product-image img {
        transform: scale(1.05);
    }
    
    .product-condition {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: var(--primary-color);
        color: var(--white);
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
    }
    
    .product-type {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: var(--accent-color);
        color: var(--white);
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
    }
    
    .product-details {
        padding: 15px;
    }
    
    .product-brand {
        font-size: 12px;
        color: var(--dark-gray);
        margin-bottom: 5px;
    }
    
    .product-name {
        font-size: 16px;
        font-weight: 500;
        margin-bottom: 10px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .product-price {
        font-size: 18px;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 10px;
    }
    
    .product-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 12px;
        color: var(--dark-gray);
    }
    
    .product-size {
        font-weight: 500;
    }
    
    .product-time {
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    /* Carregamento/Loading Spinner */
    .loading-spinner {
        display: flex;
        justify-content: center;
        margin: 30px 0;
    }
    
    .spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        width: 36px;
        height: 36px;
        border-radius: 50%;
        border-left-color: var(--primary-color);
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }
    
    .no-products {
        text-align: center;
        padding: 30px;
        background-color: var(--white);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
    }
    
    .no-products p {
        margin-bottom: 15px;
        color: var(--dark-gray);
    }
    
    .reset-filters-inline {
        padding: 8px 16px;
        background-color: var(--primary-color);
        color: var(--white);
        border-radius: var(--border-radius);
        font-weight: 500;
        transition: var(--transition);
    }
    
    .reset-filters-inline:hover {
        background-color: #e53935;
    }
    
    /* Paginação */
    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        margin-top: 30px;
    }
    
    .page-numbers {
        display: flex;
        gap: 5px;
    }
    
    .page-numbers span {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
        transition: var(--transition);
    }
    
    .page-numbers span.active {
        background-color: var(--primary-color);
        color: var(--white);
    }
    
    .page-numbers span:hover:not(.active) {
        background-color: var(--medium-gray);
    }
    
    .prev-page, .next-page {
        padding: 5px 10px;
        border: 1px solid var(--medium-gray);
        border-radius: var(--border-radius);
        transition: var(--transition);
    }
    
    .prev-page:hover, .next-page:hover {
        background-color: var(--medium-gray);
    }
    
    /* Rodapé */
    footer {
        background-color: var(--secondary-color);
        color: var(--white);
        padding: 40px 30px 20px;
    }
    
    .footer-content {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 30px;
        max-width: 1280px;
        margin: 0 auto;
    }
    
    .footer-section {
        flex: 1;
        min-width: 200px;
    }
    
    .footer-section h3 {
        font-size: 18px;
        margin-bottom: 15px;
        color: var(--primary-color);
    }
    
    .footer-section p {
        margin-bottom: 15px;
        font-size: 14px;
        color: #b0b0b0;
    }
    
    .social-links {
        display: flex;
        gap: 15px;
    }
    
    .social-links a {
        color: var(--white);
        font-size: 18px;
        transition: var(--transition);
    }
    
    .social-links a:hover {
        color: var(--primary-color);
    }
    
    .footer-section ul li {
        margin-bottom: 8px;
    }
    
    .footer-section ul li a {
        font-size: 14px;
        color: #b0b0b0;
        transition: var(--transition);
    }
    
    .footer-section ul li a:hover {
        color: var(--primary-color);
    }
    
    .footer-bottom {
        text-align: center;
        padding-top: 20px;
        margin-top: 20px;
        border-top: 1px solid #444;
        max-width: 1280px;
        margin: 20px auto 0;
    }
    
    .footer-bottom p {
        font-size: 14px;
        color: #b0b0b0;
    }
    
    /* Design Responsivo */
    @media (max-width: 992px) {
        .container {
            flex-direction: column;
        }
        
        .filters {
            width: 100%;
            position: relative;
            top: 0;
        }
        
        .size-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }
    
    @media (max-width: 768px) {
        .navbar {
            padding: 15px 20px;
        }
        
        .nav-links {
            display: none;
        }
        
        .menu-toggle {
            display: block;
        }
        
        .search-bar {
            max-width: 60%;
        }
        
        .product-grid {
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        }
        
        .size-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }
    
    @media (max-width: 576px) {
        .search-bar {
            max-width: 50%;
        }
        
        .products-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .product-grid {
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        }
        
        .footer-content {
            flex-direction: column;
        }
    }
</style>
</head>
<body>
    <!-- Barra de Navegação -->
    <nav class="navbar">
        <div class="logo">
            <a href="index.html">ResellSneakers</a>
        </div>
        <div class="search-bar">
            <input type="text" placeholder="Pesquisar sneakers..." id="search-input">
            <button id="search-button"><i class="fas fa-search"></i></button>
        </div>
        <div class="nav-links">
            <a href="index.html">Início</a>
            <a href="produtos.html" class="active">Explorar</a>
            <a href="sell.html">Vender</a>
            <a href="profile.html">Perfil</a>
            <a href="login.html" class="login-btn">Login</a>
        </div>
        <div class="menu-toggle">
            <i class="fas fa-bars"></i>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <main>
        <div class="container">
            <!-- Secção de Filtros -->
            <section class="filters">
                <h2>Filtros</h2>
                <div class="filter-group">
                    <h3>Tipo de Anúncio</h3>
                    <div class="filter-options">
                        <label><input type="checkbox" name="listing-type" value="Venda" checked> Venda</label>
                        <label><input type="checkbox" name="listing-type" value="Troca" checked> Troca</label>
                    </div>
                </div>
                
                <div class="filter-group">
                    <h3>Estado</h3>
                    <div class="filter-options">
                        <label><input type="checkbox" name="condition" value="Novo" checked> Novo</label>
                        <label><input type="checkbox" name="condition" value="Como Novo" checked> Como Novo</label>
                        <label><input type="checkbox" name="condition" value="Usado" checked> Usado</label>
                        <label><input type="checkbox" name="condition" value="Com Defeitos" checked> Com Defeitos</label>
                    </div>
                </div>
                
                <div class="filter-group">
                    <h3>Marca</h3>
                    <div class="filter-options" id="brand-filters">
                        <!-- Marcas serão carregadas dinamicamente aqui -->
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <h3>Tamanho</h3>
                    <div class="filter-options size-grid">
                        <label><input type="checkbox" name="size" value="40"> EU 40</label>
                        <label><input type="checkbox" name="size" value="40.5"> EU 40.5</label>
                        <label><input type="checkbox" name="size" value="41"> EU 41</label>
                        <label><input type="checkbox" name="size" value="42"> EU 42</label>
                        <label><input type="checkbox" name="size" value="42.5"> EU 42.5</label>
                        <label><input type="checkbox" name="size" value="43"> EU 43</label>
                        <label><input type="checkbox" name="size" value="44"> EU 44</label>
                        <label><input type="checkbox" name="size" value="44.5"> EU 44.5</label>
                        <label><input type="checkbox" name="size" value="45"> EU 45</label>
                        <label><input type="checkbox" name="size" value="45.5"> EU 45.5</label>
                        <label><input type="checkbox" name="size" value="46"> EU 46</label>
                        <label><input type="checkbox" name="size" value="47"> EU 47</label>
                    </div>
                </div>
                
                <div class="filter-group">
                    <h3>Intervalo de Preço</h3>
                    <div class="price-range">
                        <input type="range" min="0" max="2000" value="2000" id="price-slider">
                        <div class="price-inputs">
                            <input type="number" id="min-price" placeholder="Mín" value="0">
                            <span>-</span>
                            <input type="number" id="max-price" placeholder="Máx" value="2000">
                        </div>
                    </div>
                </div>
                
                <button class="apply-filters" id="apply-filters">Aplicar Filtros</button>
                <button class="reset-filters" id="reset-filters">Repor Tudo</button>
            </section>

            <!-- Secção de Produtos -->
            <section class="products">
                <div class="products-header">
                    <h2>Sneakers Disponíveis</h2>
                    <div class="sort-options">
                        <label for="sort">Ordenar por:</label>
                        <select id="sort">
                            <option value="recent">Mais Recentes</option>
                            <option value="price-low">Preço: Menor para Maior</option>
                            <option value="price-high">Preço: Maior para Menor</option>
                            <option value="popular">Mais Populares</option>
                        </select>
                    </div>
                </div>

                <div class="product-grid" id="product-container">
                    <!-- Loading spinner inicialmente -->
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                    </div>
                </div>

                <div class="pagination">
                    <button class="prev-page" id="prev-page">Anterior</button>
                    <div class="page-numbers" id="page-numbers">
                        <!-- Números de página serão gerados dinamicamente -->
                    </div>
                    <button class="next-page" id="next-page">Próximo</button>
                </div>
            </section>
        </div>
    </main>

    <!-- Rodapé -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>ResellSneakers</h3>
                <p>O mercado definitivo para entusiastas de sneakers.</p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Links Rápidos</h3>
                <ul>
                    <li><a href="#">Início</a></li>
                    <li><a href="#">Explorar</a></li>
                    <li><a href="#">Vender</a></li>
                    <li><a href="#">A Minha Conta</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contacte-nos</h3>
                <p>Email: info@resellsneakers.com</p>
                <p>Horário de Apoio: 9h - 17h</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 ResellSneakers. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- Firebase -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.2/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.2/firebase-firestore-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.2/firebase-auth-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.2/firebase-storage-compat.min.js"></script>
    
    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            // Inserir configuração do Firebase aqui
            apiKey: "YOUR_API_KEY",
            authDomain: "resellsneakers-xxxxx.firebaseapp.com",
            projectId: "resellsneakers-xxxxx",
            storageBucket: "resellsneakers-xxxxx.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Inicializar Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Estado da aplicação
        let state = {
            products: [],
            filteredProducts: [],
            brands: new Set(),
            filters: {
                listingTypes: ["Venda", "Troca"],
                conditions: ["Novo", "Como Novo", "Usado", "Com Defeitos"],
                brands: [],
                sizes: [],
                minPrice: 0,
                maxPrice: 2000,
                searchQuery: "",
                sortBy: "recent"
            },
            pagination: {
                currentPage: 1,
                itemsPerPage: 12,
                totalPages: 1
            },
            isLoading: true
        };

        // Elementos DOM
        const productContainer = document.getElementById('product-container');
        const sortSelect = document.getElementById('sort');
        const brandFiltersContainer = document.getElementById('brand-filters');
        const conditionCheckboxes = document.querySelectorAll('input[name="condition"]');
        const listingTypeCheckboxes = document.querySelectorAll('input[name="listing-type"]');
        const sizeCheckboxes = document.querySelectorAll('input[name="size"]');
        const priceSlider = document.getElementById('price-slider');
        const minPriceInput = document.getElementById('min-price');
        const maxPriceInput = document.getElementById('max-price');
        const applyFiltersBtn = document.getElementById('apply-filters');
        const resetFiltersBtn = document.getElementById('reset-filters');
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const pageNumbers = document.getElementById('page-numbers');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');

        // Inicializar a página
        document.addEventListener('DOMContentLoaded', () => {
            // Carregar produtos do Firestore
            fetchProducts();
            
            // Configurar event listeners
            setupEventListeners();
        });

        // Função para buscar produtos no Firestore
        async function fetchProducts() {
            try {
                state.isLoading = true;
                updateUI();
                
                // Iniciar a query no Firestore
                const productsRef = db.collection('products');
                const snapshot = await productsRef.get();
                
                if (snapshot.empty) {
                    state.products = [];
                    state.filteredProducts = [];
                    state.isLoading = false;
                    updateUI();
                    return;
                }
                
                // Processar os documentos
                const products = [];
                snapshot.forEach(doc => {
                    const product = {
                        id: doc.id,
                        ...doc.data(),
                        postedTime: doc.data().postedTime ? doc.data().postedTime.toDate() : new Date()
                    };
                    
                    // Adicionar a marca ao conjunto de marcas
                    if (product.brand) {
                        state.brands.add(product.brand);
                    }
                    
                    products.push(product);
                });
                
                state.products = products;
                
                // Preencher o filtro de marcas
                populateBrandFilters();
                
                // Aplicar filtros iniciais
                filterProducts();
                
                state.isLoading = false;
                updateUI();
                
            } catch (error) {
                console.error("Erro ao carregar produtos:", error);
                state.isLoading = false;
                updateUI();
            }
        }

        // Função para preencher o filtro de marcas
        function populateBrandFilters() {
            brandFiltersContainer.innerHTML = '';
            
            // Converter o Set para um array e ordenar alfabeticamente
            const sortedBrands = Array.from(state.brands).sort();
            
            sortedBrands.forEach(brand => {
                const label = document.createElement('label');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = brand;
                checkbox.name = 'brand';
                checkbox.checked = state.filters.brands.includes(brand);
                checkbox.addEventListener('change', handleBrandFilterChange);
                
                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(` ${brand}`));
                
                brandFiltersContainer.appendChild(label);
            });
        }

        // Função para filtrar produtos
function filterProducts() {
    const {
        listingTypes,
        conditions,
        brands,
        sizes,
        minPrice,
        maxPrice,
        searchQuery,
        sortBy
    } = state.filters;
    
    // Aplicar os filtros
    state.filteredProducts = state.products.filter(product => {
        // Filtrar por tipo de anúncio
        if (!listingTypes.includes(product.listingType)) return false;
        
        // Filtrar por condição
        if (!conditions.includes(product.condition)) return false;
        
        // Filtrar por marca
        if (brands.length > 0 && !brands.includes(product.brand)) return false;
        
        // Filtrar por tamanho
        if (sizes.length > 0 && !sizes.includes(product.size.toString())) return false;
        
        // Filtrar por intervalo de preço
        if (product.price < minPrice || product.price > maxPrice) return false;
        
        // Filtrar por pesquisa
        if (searchQuery) {
            const query = searchQuery.toLowerCase();
            const matchesName = product.name.toLowerCase().includes(query);
            const matchesBrand = product.brand.toLowerCase().includes(query);
            const matchesDescription = product.description && product.description.toLowerCase().includes(query);
            
            if (!matchesName && !matchesBrand && !matchesDescription) return false;
        }
        
        return true;
    });
    
    // Aplicar ordenação
    sortProducts(sortBy);
    
    // Atualizar paginação
    updatePagination();
}

// Função para ordenar produtos
function sortProducts(sortBy) {
    switch (sortBy) {
        case 'recent':
            state.filteredProducts.sort((a, b) => b.postedTime - a.postedTime);
            break;
        case 'price-low':
            state.filteredProducts.sort((a, b) => a.price - b.price);
            break;
        case 'price-high':
            state.filteredProducts.sort((a, b) => b.price - a.price);
            break;
        case 'popular':
            state.filteredProducts.sort((a, b) => (b.views || 0) - (a.views || 0));
            break;
        default:
            state.filteredProducts.sort((a, b) => b.postedTime - a.postedTime);
    }
}

// Função para atualizar a paginação
function updatePagination() {
    const { itemsPerPage } = state.pagination;
    const totalItems = state.filteredProducts.length;
    
    state.pagination.totalPages = Math.ceil(totalItems / itemsPerPage) || 1;
    
    // Garantir que a página atual não seja maior que o total de páginas
    if (state.pagination.currentPage > state.pagination.totalPages) {
        state.pagination.currentPage = state.pagination.totalPages;
    }
    
    // Atualizar os botões de navegação
    updatePaginationButtons();
}

// Função para atualizar os botões de paginação
function updatePaginationButtons() {
    const { currentPage, totalPages } = state.pagination;
    
    // Limpar os números de página atuais
    pageNumbers.innerHTML = '';
    
    // Determinar quais páginas mostrar
    let startPage = Math.max(1, currentPage - 2);
    let endPage = Math.min(totalPages, startPage + 4);
    
    if (endPage - startPage < 4) {
        startPage = Math.max(1, endPage - 4);
    }
    
    // Adicionar o primeiro número de página se necessário
    if (startPage > 1) {
        const firstPage = document.createElement('span');
        firstPage.textContent = '1';
        firstPage.dataset.page = 1;
        firstPage.addEventListener('click', () => goToPage(1));
        pageNumbers.appendChild(firstPage);
        
        if (startPage > 2) {
            const ellipsis = document.createElement('span');
            ellipsis.textContent = '...';
            ellipsis.classList.add('ellipsis');
            pageNumbers.appendChild(ellipsis);
        }
    }
    
    // Adicionar os números de página
    for (let i = startPage; i <= endPage; i++) {
        const pageSpan = document.createElement('span');
        pageSpan.textContent = i;
        pageSpan.dataset.page = i;
        
        if (i === currentPage) {
            pageSpan.classList.add('active');
        }
        
        pageSpan.addEventListener('click', () => goToPage(i));
        pageNumbers.appendChild(pageSpan);
    }
    
    // Adicionar o último número de página se necessário
    if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
            const ellipsis = document.createElement('span');
            ellipsis.textContent = '...';
            ellipsis.classList.add('ellipsis');
            pageNumbers.appendChild(ellipsis);
        }
        
        const lastPage = document.createElement('span');
        lastPage.textContent = totalPages;
        lastPage.dataset.page = totalPages;
        lastPage.addEventListener('click', () => goToPage(totalPages));
        pageNumbers.appendChild(lastPage);
    }
    
    // Atualizar estado dos botões de navegação
    prevPageBtn.disabled = currentPage === 1;
    nextPageBtn.disabled = currentPage === totalPages;
}

// Função para navegar para uma página específica
function goToPage(page) {
    state.pagination.currentPage = page;
    updateUI();
}

// Função para atualizar a interface
function updateUI() {
    // Atualizar a lista de produtos
    renderProducts();
    
    // Atualizar os botões de paginação
    updatePaginationButtons();
}

// Função para renderizar produtos
function renderProducts() {
    // Limpar o container de produtos
    productContainer.innerHTML = '';
    
    // Mostrar spinner de carregamento se necessário
    if (state.isLoading) {
        productContainer.innerHTML = `
            <div class="loading-spinner">
                <div class="spinner"></div>
            </div>
        `;
        return;
    }
    
    // Mostrar mensagem se não houver produtos
    if (state.filteredProducts.length === 0) {
        productContainer.innerHTML = `
            <div class="no-products">
                <p>Não foram encontrados produtos que correspondam aos filtros selecionados.</p>
                <button class="reset-filters-inline" id="reset-filters-inline">Limpar Filtros</button>
            </div>
        `;
        
        document.getElementById('reset-filters-inline').addEventListener('click', resetFilters);
        return;
    }
    
    // Calcular o intervalo de produtos a mostrar na página atual
    const { currentPage, itemsPerPage } = state.pagination;
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const currentProducts = state.filteredProducts.slice(startIndex, endIndex);
    
    // Renderizar cada produto
    currentProducts.forEach(product => {
        const productCard = createProductCard(product);
        productContainer.appendChild(productCard);
    });
}

// Função para criar um cartão de produto
function createProductCard(product) {
    const productCard = document.createElement('div');
    productCard.className = 'product-card';
    productCard.dataset.id = product.id;
    
    // Calcular tempo desde a publicação
    const timeAgo = getTimeAgo(product.postedTime);
    
    productCard.innerHTML = `
        <div class="product-image">
            <img src="${product.imageUrl || '/images/placeholder.jpg'}" alt="${product.name}">
            <div class="product-condition">${product.condition}</div>
            <div class="product-type">${product.listingType}</div>
        </div>
        <div class="product-details">
            <div class="product-brand">${product.brand}</div>
            <h3 class="product-name">${product.name}</h3>
            <div class="product-price">${product.price.toFixed(2)}€</div>
            <div class="product-meta">
                <span class="product-size">Tam. ${product.size}</span>
                <span class="product-time">
                    <i class="far fa-clock"></i> ${timeAgo}
                </span>
            </div>
        </div>
    `;
    
    // Adicionar evento para redirecionamento para a página de detalhes
    productCard.addEventListener('click', () => {
        window.location.href = `product-details.html?id=${product.id}`;
    });
    
    return productCard;
}

// Função para calcular o tempo decorrido desde uma data
function getTimeAgo(date) {
    if (!date) return 'Agora';
    
    const now = new Date();
    const diffInSeconds = Math.floor((now - date) / 1000);
    
    if (diffInSeconds < 60) {
        return 'Agora';
    }
    
    const diffInMinutes = Math.floor(diffInSeconds / 60);
    if (diffInMinutes < 60) {
        return `${diffInMinutes}m atrás`;
    }
    
    const diffInHours = Math.floor(diffInMinutes / 60);
    if (diffInHours < 24) {
        return `${diffInHours}h atrás`;
    }
    
    const diffInDays = Math.floor(diffInHours / 24);
    if (diffInDays < 30) {
        return `${diffInDays}d atrás`;
    }
    
    const diffInMonths = Math.floor(diffInDays / 30);
    return `${diffInMonths}m atrás`;
}

// Função para configurar event listeners
function setupEventListeners() {
    // Event listener para ordenação
    sortSelect.addEventListener('change', () => {
        state.filters.sortBy = sortSelect.value;
        sortProducts(state.filters.sortBy);
        state.pagination.currentPage = 1;
        updateUI();
    });
    
    // Event listeners para checkboxes de tipo de anúncio
    listingTypeCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', handleListingTypeFilterChange);
    });
    
    // Event listeners para checkboxes de condição
    conditionCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', handleConditionFilterChange);
    });
    
    // Event listeners para checkboxes de tamanho
    sizeCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', handleSizeFilterChange);
    });
    
    // Event listener para slider de preço
    priceSlider.addEventListener('input', () => {
        maxPriceInput.value = priceSlider.value;
        state.filters.maxPrice = parseInt(priceSlider.value);
    });
    
    // Event listeners para inputs de preço
    minPriceInput.addEventListener('input', () => {
        state.filters.minPrice = parseInt(minPriceInput.value) || 0;
    });
    
    maxPriceInput.addEventListener('input', () => {
        const newMaxPrice = parseInt(maxPriceInput.value) || 2000;
        state.filters.maxPrice = newMaxPrice;
        priceSlider.value = newMaxPrice;
    });
    
    // Event listener para botão de aplicar filtros
    applyFiltersBtn.addEventListener('click', () => {
        filterProducts();
        state.pagination.currentPage = 1;
        updateUI();
    });
    
    // Event listener para botão de resetar filtros
    resetFiltersBtn.addEventListener('click', resetFilters);
    
    // Event listeners para pesquisa
    searchInput.addEventListener('keyup', event => {
        if (event.key === 'Enter') {
            state.filters.searchQuery = searchInput.value;
            filterProducts();
            state.pagination.currentPage = 1;
            updateUI();
        }
    });
    
    searchButton.addEventListener('click', () => {
        state.filters.searchQuery = searchInput.value;
        filterProducts();
        state.pagination.currentPage = 1;
        updateUI();
    });
    
    // Event listeners para paginação
    prevPageBtn.addEventListener('click', () => {
        if (state.pagination.currentPage > 1) {
            state.pagination.currentPage--;
            updateUI();
        }
    });
    
    nextPageBtn.addEventListener('click', () => {
        if (state.pagination.currentPage < state.pagination.totalPages) {
            state.pagination.currentPage++;
            updateUI();
        }
    });
    
    // Event listener para toggle de menu em dispositivos móveis
    document.querySelector('.menu-toggle').addEventListener('click', toggleMenu);
}

// Function para alternar menu móvel
function toggleMenu() {
    const navLinks = document.querySelector('.nav-links');
    navLinks.classList.toggle('active');
}

// Funções para lidar com alterações nos filtros
function handleListingTypeFilterChange(event) {
    const { value, checked } = event.target;
    
    if (checked) {
        if (!state.filters.listingTypes.includes(value)) {
            state.filters.listingTypes.push(value);
        }
    } else {
        state.filters.listingTypes = state.filters.listingTypes.filter(type => type !== value);
    }
}

function handleConditionFilterChange(event) {
    const { value, checked } = event.target;
    
    if (checked) {
        if (!state.filters.conditions.includes(value)) {
            state.filters.conditions.push(value);
        }
    } else {
        state.filters.conditions = state.filters.conditions.filter(condition => condition !== value);
    }
}

function handleBrandFilterChange(event) {
    const { value, checked } = event.target;
    
    if (checked) {
        if (!state.filters.brands.includes(value)) {
            state.filters.brands.push(value);
        }
    } else {
        state.filters.brands = state.filters.brands.filter(brand => brand !== value);
    }
}

function handleSizeFilterChange(event) {
    const { value, checked } = event.target;
    
    if (checked) {
        if (!state.filters.sizes.includes(value)) {
            state.filters.sizes.push(value);
        }
    } else {
        state.filters.sizes = state.filters.sizes.filter(size => size !== value);
    }
}

// Função para resetar todos os filtros
function resetFilters() {
    // Resetar as checkboxes
    listingTypeCheckboxes.forEach(checkbox => {
        checkbox.checked = true;
    });
    
    conditionCheckboxes.forEach(checkbox => {
        checkbox.checked = true;
    });
    
    document.querySelectorAll('input[name="brand"]').forEach(checkbox => {
        checkbox.checked = false;
    });
    
    sizeCheckboxes.forEach(checkbox => {
        checkbox.checked = false;
    });
    
    // Resetar o slider e inputs de preço
    priceSlider.value = 2000;
    minPriceInput.value = 0;
    maxPriceInput.value = 2000;
    
    // Limpar o campo de pesquisa
    searchInput.value = '';
    
    // Resetar o estado dos filtros
    state.filters = {
        listingTypes: ["Venda", "Troca"],
        conditions: ["Novo", "Como Novo", "Usado", "Com Defeitos"],
        brands: [],
        sizes: [],
        minPrice: 0,
        maxPrice: 2000,
        searchQuery: "",
        sortBy: sortSelect.value
    };
    
    // Aplicar os filtros resetados
    filterProducts();
    state.pagination.currentPage = 1;
    updateUI();
}

// Função para simular dados iniciais (apenas para desenvolvimento)
function mockProducts() {
    // Em ambiente de produção, esta função pode ser removida pois os dados virão do Firestore
    if (state.products.length > 0) return;
    
    const brands = ['Nike', 'Adidas', 'Jordan', 'New Balance', 'Puma', 'Vans', 'Converse', 'Reebok'];
    const conditions = ['Novo', 'Como Novo', 'Usado', 'Com Defeitos'];
    const listingTypes = ['Venda', 'Troca'];
    const sizes = [40, 40.5, 41, 42, 42.5, 43, 44, 44.5, 45, 45.5, 46];
    const names = [
        'Air Force 1', 'Dunk Low', 'Jordan 1', 'Yeezy 350', 'Air Max 90', 'Stan Smith',
        'Vans Old Skool', 'Chuck Taylor', 'Ultraboost', 'NMD', '550', '990', 'Suede Classic'
    ];
    
    const mockProducts = [];
    
    for (let i = 1; i <= 50; i++) {
        const brand = brands[Math.floor(Math.random() * brands.length)];
        const condition = conditions[Math.floor(Math.random() * conditions.length)];
        const listingType = listingTypes[Math.floor(Math.random() * listingTypes.length)];
        const size = sizes[Math.floor(Math.random() * sizes.length)];
        const name = `${brand} ${names[Math.floor(Math.random() * names.length)]}`;
        const price = Math.floor(Math.random() * 1800) + 50;
        const views = Math.floor(Math.random() * 500);
        
        // Data aleatória nos últimos 30 dias
        const daysAgo = Math.floor(Math.random() * 30);
        const postedTime = new Date();
        postedTime.setDate(postedTime.getDate() - daysAgo);
        
        const product = {
            id: `prod-${i}`,
            brand,
            name,
            condition,
            listingType,
            size,
            price,
            views,
            postedTime,
            description: `${brand} ${name} em tamanho ${size}. ${condition}. ${listingType === 'Troca' ? 'Aberto a trocas.' : ''}`,
            imageUrl: `/api/placeholder/300/300` // Placeholder para desenvolvimento
        };
        
        mockProducts.push(product);
        state.brands.add(brand);
    }
    
    state.products = mockProducts;
    state.filteredProducts = [...mockProducts];
    
    // Ordenar por mais recentes por padrão
    sortProducts('recent');
}

// Chamar a função de mock se estivermos em desenvolvimento
// Em produção, remover ou comentar esta linha
if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
    mockProducts();
    populateBrandFilters();
    updatePagination();
    updateUI();
}